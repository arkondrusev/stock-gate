package com.sadkoala.stockgate.parser;

import com.fasterxml.jackson.databind.JsonNode;
import com.sadkoala.stockgate.GateUtils;
import com.sadkoala.stockgate.parser.model.Order;

import java.io.IOException;
import java.math.BigDecimal;
import java.util.ArrayList;
import java.util.List;

public class BinanceParser extends AbstractStockParser {

    /**
     * пример инпута {"symbol":"BTCUSDT","price":"5343.93000000"}
     */
    public static String parseBtcPrice(final String jsonString) throws IOException {
        return mapper.readTree(jsonString).get("price").asText();
    }

    /**
     * [{"symbol":"BTCUSDT","orderId":1164435203,"orderListId":-1,"clientOrderId":"and_059bea04ee574a76878c4de37dae7e7c","price":"10510.00000000","origQty":"0.00299700","executedQty":"0.00000000","cummulativeQuoteQty":"0.00000000","status":"NEW","timeInForce":"GTC","type":"LIMIT","side":"SELL","stopPrice":"0.00000000","icebergQty":"0.00000000","time":1581506942308,"updateTime":1581506942308,"isWorking":true,"origQuoteOrderQty":"0.00000000"},{"symbol":"BTCUSDT","orderId":1260089828,"orderListId":-1,"clientOrderId":"and_abe6014b4bf941409f49751dc85b696a","price":"10096.00000000","origQty":"0.00199800","executedQty":"0.00000000","cummulativeQuoteQty":"0.00000000","status":"NEW","timeInForce":"GTC","type":"LIMIT","side":"SELL","stopPrice":"0.00000000","icebergQty":"0.00000000","time":1582506033911,"updateTime":1582506033911,"isWorking":true,"origQuoteOrderQty":"0.00000000"},{"symbol":"BTCUSDT","orderId":1267003061,"orderListId":-1,"clientOrderId":"and_207e111c2fa54299b6bc2478a9820afb","price":"9778.00000000","origQty":"0.00199800","executedQty":"0.00000000","cummulativeQuoteQty":"0.00000000","status":"NEW","timeInForce":"GTC","type":"LIMIT","side":"SELL","stopPrice":"0.00000000","icebergQty":"0.00000000","time":1582566264887,"updateTime":1582566264887,"isWorking":true,"origQuoteOrderQty":"0.00000000"},{"symbol":"BTCUSDT","orderId":1277532840,"orderListId":-1,"clientOrderId":"and_15340604ac5d4fe98e92a132218a34b5","price":"9500.00000000","origQty":"0.00199800","executedQty":"0.00000000","cummulativeQuoteQty":"0.00000000","status":"NEW","timeInForce":"GTC","type":"LIMIT","side":"SELL","stopPrice":"0.00000000","icebergQty":"0.00000000","time":1582660543049,"updateTime":1582660543049,"isWorking":true,"origQuoteOrderQty":"0.00000000"},{"symbol":"BTCUSDT","orderId":1391297417,"orderListId":-1,"clientOrderId":"and_5daa9b8507e6430aaf2d3213b3809f86","price":"8775.00000000","origQty":"0.00149800","executedQty":"0.00000000","cummulativeQuoteQty":"0.00000000","status":"NEW","timeInForce":"GTC","type":"LIMIT","side":"SELL","stopPrice":"0.00000000","icebergQty":"0.00000000","time":1583677831158,"updateTime":1583677831158,"isWorking":true,"origQuoteOrderQty":"0.00000000"},{"symbol":"BTCUSDT","orderId":1395823255,"orderListId":-1,"clientOrderId":"web_309cf887aedf4a8a90ba14504bc388c5","price":"8323.00000000","origQty":"0.00149900","executedQty":"0.00000000","cummulativeQuoteQty":"0.00000000","status":"NEW","timeInForce":"GTC","type":"LIMIT","side":"SELL","stopPrice":"0.00000000","icebergQty":"0.00000000","time":1583709539088,"updateTime":1583709539088,"isWorking":true,"origQuoteOrderQty":"0.00000000"},{"symbol":"BTCUSDT","orderId":1439514387,"orderListId":-1,"clientOrderId":"web_90167b5eb30f4feeb39d3d8ff12277d2","price":"7472.00000000","origQty":"0.00149900","executedQty":"0.00000000","cummulativeQuoteQty":"0.00000000","status":"NEW","timeInForce":"GTC","type":"LIMIT","side":"SELL","stopPrice":"0.00000000","icebergQty":"0.00000000","time":1584006155832,"updateTime":1584006155832,"isWorking":true,"origQuoteOrderQty":"0.00000000"},{"symbol":"BTCUSDT","orderId":1558996845,"orderListId":-1,"clientOrderId":"web_b26636b406374bb4b15cb23fc47e2047","price":"6955.00000000","origQty":"0.00199800","executedQty":"0.00000000","cummulativeQuoteQty":"0.00000000","status":"NEW","timeInForce":"GTC","type":"LIMIT","side":"SELL","stopPrice":"0.00000000","icebergQty":"0.00000000","time":1584700820952,"updateTime":1584700820952,"isWorking":true,"origQuoteOrderQty":"0.00000000"},{"symbol":"BTCUSDT","orderId":1600922780,"orderListId":-1,"clientOrderId":"web_ed1846e283db42ad820ee29cb5771c86","price":"7225.00000000","origQty":"0.00200000","executedQty":"0.00000000","cummulativeQuoteQty":"0.00000000","status":"NEW","timeInForce":"GTC","type":"LIMIT","side":"SELL","stopPrice":"0.00000000","icebergQty":"0.00000000","time":1584968125428,"updateTime":1584968125428,"isWorking":true,"origQuoteOrderQty":"0.00000000"},{"symbol":"BTCUSDT","orderId":1612483525,"orderListId":-1,"clientOrderId":"web_4d711ae8874d4fbca6cf3d770ac771d2","price":"7725.00000000","origQty":"0.00200000","executedQty":"0.00000000","cummulativeQuoteQty":"0.00000000","status":"NEW","timeInForce":"GTC","type":"LIMIT","side":"SELL","stopPrice":"0.00000000","icebergQty":"0.00000000","time":1585039042242,"updateTime":1585039042242,"isWorking":true,"origQuoteOrderQty":"0.00000000"}]
     */
    public static List<Order> parseOpenOrders(final String jsonString) throws IOException {
        List<Order> parsedOrders = new ArrayList<>();
        for (JsonNode order : mapper.readTree(jsonString)) {
            parsedOrders.add(new Order("binance",
                    order.get("symbol").asText(),
                    order.get("orderId").asText(),
                    new BigDecimal(order.get("price").asText()),
                    new BigDecimal(order.get("origQty").asText()),
                    order.get("status").asText(),
                    order.get("time").asLong()));
        }
        return parsedOrders;
    }

    /**
     * {"makerCommission":10,"takerCommission":10,"buyerCommission":0,"sellerCommission":0,"canTrade":true,"canWithdraw":true,"canDeposit":true,"updateTime":1586198814036,"accountType":"MARGIN","balances":[{"asset":"BTC","free":"0.00000078","locked":"0.01548700"},{"asset":"LTC","free":"0.00000000","locked":"0.24975000"},{"asset":"ETH","free":"0.00000390","locked":"0.06993000"},{"asset":"NEO","free":"0.00243000","locked":"0.00000000"},{"asset":"BNB","free":"1.02212388","locked":"0.00000000"},{"asset":"QTUM","free":"0.00000000","locked":"0.00000000"},{"asset":"EOS","free":"0.00767000","locked":"0.00000000"},{"asset":"SNT","free":"0.00000000","locked":"0.00000000"},{"asset":"BNT","free":"0.00000000","locked":"0.00000000"},{"asset":"GAS","free":"0.01616750","locked":"0.00000000"},{"asset":"BCC","free":"0.00000000","locked":"0.00000000"},{"asset":"USDT","free":"123.10131005","locked":"0.00000000"},{"asset":"HSR","free":"0.00000000","locked":"0.00000000"},{"asset":"OAX","free":"0.00000000","locked":"0.00000000"},{"asset":"DNT","free":"0.00000000","locked":"0.00000000"},{"asset":"MCO","free":"0.00000000","locked":"0.00000000"},{"asset":"ICN","free":"0.00000000","locked":"0.00000000"},{"asset":"ZRX","free":"0.00000000","locked":"0.00000000"},{"asset":"OMG","free":"0.00000000","locked":"0.00000000"},{"asset":"WTC","free":"0.00000000","locked":"0.00000000"},{"asset":"YOYO","free":"0.00000000","locked":"0.00000000"},{"asset":"LRC","free":"0.00000000","locked":"0.00000000"},{"asset":"TRX","free":"0.88800000","locked":"0.00000000"},{"asset":"SNGLS","free":"0.00000000","locked":"0.00000000"},{"asset":"STRAT","free":"0.00000000","locked":"0.00000000"},{"asset":"BQX","free":"0.00000000","locked":"0.00000000"},{"asset":"FUN","free":"0.00000000","locked":"0.00000000"},{"asset":"KNC","free":"0.00000000","locked":"0.00000000"},{"asset":"CDT","free":"0.00000000","locked":"0.00000000"},{"asset":"XVG","free":"0.00000000","locked":"0.00000000"},{"asset":"IOTA","free":"7.86900000","locked":"0.00000000"},{"asset":"SNM","free":"0.77200000","locked":"0.00000000"},{"asset":"LINK","free":"0.00000000","locked":"0.00000000"},{"asset":"CVC","free":"0.00100000","locked":"0.00000000"},{"asset":"TNT","free":"0.00000000","locked":"0.00000000"},{"asset":"REP","free":"0.00000000","locked":"0.00000000"},{"asset":"MDA","free":"0.00000000","locked":"0.00000000"},{"asset":"MTL","free":"0.00000000","locked":"0.00000000"},{"asset":"SALT","free":"0.00000000","locked":"0.00000000"},{"asset":"NULS","free":"0.00000000","locked":"0.00000000"},{"asset":"SUB","free":"0.00000000","locked":"0.00000000"},{"asset":"STX","free":"0.00000000","locked":"0.00000000"},{"asset":"MTH","free":"0.00000000","locked":"0.00000000"},{"asset":"ADX","free":"0.00000000","locked":"0.00000000"},{"asset":"ETC","free":"0.00920000","locked":"0.00000000"},{"asset":"ENG","free":"0.00000000","locked":"0.00000000"},{"asset":"ZEC","free":"0.00000000","locked":"0.00000000"},{"asset":"AST","free":"0.00000000","locked":"0.00000000"},{"asset":"GNT","free":"0.00000000","locked":"0.00000000"},{"asset":"DGD","free":"0.00000000","locked":"0.00000000"},{"asset":"BAT","free":"0.00000000","locked":"0.00000000"},{"asset":"DASH","free":"0.04274700","locked":"0.00000000"},{"asset":"POWR","free":"0.00000000","locked":"0.00000000"},{"asset":"BTG","free":"0.00000000","locked":"0.00000000"},{"asset":"REQ","free":"0.00000000","locked":"0.00000000"},{"asset":"XMR","free":"0.00000600","locked":"0.24975000"},{"asset":"EVX","free":"0.00000000","locked":"0.00000000"},{"asset":"VIB","free":"0.00000000","locked":"0.00000000"},{"asset":"ENJ","free":"0.00000000","locked":"0.00000000"},{"asset":"VEN","free":"0.00000000","locked":"0.00000000"},{"asset":"ARK","free":"0.00000000","locked":"0.00000000"},{"asset":"XRP","free":"0.91700000","locked":"0.00000000"},{"asset":"MOD","free":"0.00000000","locked":"0.00000000"},{"asset":"STORJ","free":"0.00000000","locked":"0.00000000"},{"asset":"KMD","free":"0.00000000","locked":"0.00000000"},{"asset":"RCN","free":"0.00000000","locked":"0.00000000"},{"asset":"EDO","free":"0.00000000","locked":"0.00000000"},{"asset":"DATA","free":"0.00000000","locked":"0.00000000"},{"asset":"DLT","free":"0.00000000","locked":"0.00000000"},{"asset":"MANA","free":"0.00000000","locked":"0.00000000"},{"asset":"PPT","free":"0.00000000","locked":"0.00000000"},{"asset":"RDN","free":"0.00000000","locked":"0.00000000"},{"asset":"GXS","free":"0.00000000","locked":"0.00000000"},{"asset":"AMB","free":"0.00000000","locked":"0.00000000"},{"asset":"ARN","free":"0.00000000","locked":"0.00000000"},{"asset":"BCPT","free":"0.00000000","locked":"0.00000000"},{"asset":"CND","free":"0.00000000","locked":"0.00000000"},{"asset":"GVT","free":"0.00000000","locked":"0.00000000"},{"asset":"POE","free":"0.00000000","locked":"0.00000000"},{"asset":"BTS","free":"0.00000000","locked":"0.00000000"},{"asset":"FUEL","free":"0.00000000","locked":"0.00000000"},{"asset":"XZC","free":"0.00000000","locked":"0.00000000"},{"asset":"QSP","free":"0.00000000","locked":"0.00000000"},{"asset":"LSK","free":"0.00000000","locked":"0.00000000"},{"asset":"BCD","free":"0.00012800","locked":"0.00000000"},{"asset":"TNB","free":"0.00000000","locked":"0.00000000"},{"asset":"ADA","free":"20.95800000","locked":"0.00000000"},{"asset":"LEND","free":"0.00000000","locked":"0.00000000"},{"asset":"XLM","free":"0.57800000","locked":"0.00000000"},{"asset":"CMT","free":"0.00000000","locked":"0.00000000"},{"asset":"WAVES","free":"0.00000000","locked":"0.00000000"},{"asset":"WABI","free":"0.00000000","locked":"0.00000000"},{"asset":"GTO","free":"0.00000000","locked":"0.00000000"},{"asset":"ICX","free":"0.00000000","locked":"0.00000000"},{"asset":"OST","free":"0.00000000","locked":"0.00000000"},{"asset":"ELF","free":"0.00000000","locked":"0.00000000"},{"asset":"AION","free":"0.00000000","locked":"0.00000000"},{"asset":"WINGS","free":"0.00000000","locked":"0.00000000"},{"asset":"BRD","free":"0.00000000","locked":"0.00000000"},{"asset":"NEBL","free":"0.00000000","locked":"0.00000000"},{"asset":"NAV","free":"0.00000000","locked":"0.00000000"},{"asset":"VIBE","free":"0.00000000","locked":"0.00000000"},{"asset":"LUN","free":"0.00000000","locked":"0.00000000"},{"asset":"TRIG","free":"0.00000000","locked":"0.00000000"},{"asset":"APPC","free":"0.00000000","locked":"0.00000000"},{"asset":"CHAT","free":"0.00000000","locked":"0.00000000"},{"asset":"RLC","free":"0.00000000","locked":"0.00000000"},{"asset":"INS","free":"0.00000000","locked":"0.00000000"},{"asset":"PIVX","free":"0.00000000","locked":"0.00000000"},{"asset":"IOST","free":"0.02300000","locked":"0.00000000"},{"asset":"STEEM","free":"0.00000000","locked":"0.00000000"},{"asset":"NANO","free":"0.00000000","locked":"0.00000000"},{"asset":"AE","free":"0.00315000","locked":"0.00000000"},{"asset":"VIA","free":"0.00000000","locked":"0.00000000"},{"asset":"BLZ","free":"0.00000000","locked":"0.00000000"},{"asset":"SYS","free":"0.00000000","locked":"0.00000000"},{"asset":"RPX","free":"0.00000000","locked":"0.00000000"},{"asset":"NCASH","free":"0.00000000","locked":"0.00000000"},{"asset":"POA","free":"0.00000000","locked":"0.00000000"},{"asset":"ONT","free":"0.00000000","locked":"0.00000000"},{"asset":"ZIL","free":"0.00000000","locked":"0.00000000"},{"asset":"STORM","free":"0.00000000","locked":"0.00000000"},{"asset":"XEM","free":"0.00000000","locked":"0.00000000"},{"asset":"WAN","free":"0.00000000","locked":"0.00000000"},{"asset":"WPR","free":"0.00000000","locked":"0.00000000"},{"asset":"QLC","free":"0.00000000","locked":"0.00000000"},{"asset":"GRS","free":"0.00000000","locked":"0.00000000"},{"asset":"CLOAK","free":"0.00000000","locked":"0.00000000"},{"asset":"LOOM","free":"0.00000000","locked":"0.00000000"},{"asset":"BCN","free":"0.00000000","locked":"0.00000000"},{"asset":"TUSD","free":"0.00000000","locked":"0.00000000"},{"asset":"ZEN","free":"0.00100000","locked":"0.00000000"},{"asset":"SKY","free":"0.00000000","locked":"0.00000000"},{"asset":"THETA","free":"0.00000000","locked":"0.00000000"},{"asset":"IOTX","free":"0.00000000","locked":"0.00000000"},{"asset":"QKC","free":"0.00000000","locked":"0.00000000"},{"asset":"AGI","free":"0.00000000","locked":"0.00000000"},{"asset":"NXS","free":"0.00000000","locked":"0.00000000"},{"asset":"SC","free":"0.00000000","locked":"0.00000000"},{"asset":"NPXS","free":"0.00000000","locked":"0.00000000"},{"asset":"KEY","free":"0.00000000","locked":"0.00000000"},{"asset":"NAS","free":"0.00000000","locked":"0.00000000"},{"asset":"MFT","free":"0.00000000","locked":"0.00000000"},{"asset":"DENT","free":"0.00000000","locked":"0.00000000"},{"asset":"ARDR","free":"0.00000000","locked":"0.00000000"},{"asset":"HOT","free":"0.00000000","locked":"0.00000000"},{"asset":"VET","free":"0.00000000","locked":"0.00000000"},{"asset":"DOCK","free":"0.00000000","locked":"0.00000000"},{"asset":"POLY","free":"0.00000000","locked":"0.00000000"},{"asset":"ONG","free":"0.00000000","locked":"0.00000000"},{"asset":"PHX","free":"0.00000000","locked":"0.00000000"},{"asset":"HC","free":"0.00000000","locked":"0.00000000"},{"asset":"GO","free":"0.00000000","locked":"0.00000000"},{"asset":"PAX","free":"0.00000000","locked":"0.00000000"},{"asset":"RVN","free":"0.00000000","locked":"0.00000000"},{"asset":"DCR","free":"0.00000000","locked":"0.00000000"},{"asset":"USDC","free":"0.00000000","locked":"0.00000000"},{"asset":"MITH","free":"0.00000000","locked":"0.00000000"},{"asset":"BCHABC","free":"0.00000000","locked":"0.00000000"},{"asset":"BCHSV","free":"0.00060400","locked":"0.00000000"},{"asset":"REN","free":"0.00000000","locked":"0.00000000"},{"asset":"BTT","free":"0.00000000","locked":"0.00000000"},{"asset":"USDS","free":"0.00000000","locked":"0.00000000"},{"asset":"FET","free":"0.00000000","locked":"0.00000000"},{"asset":"TFUEL","free":"0.00000000","locked":"0.00000000"},{"asset":"CELR","free":"0.00000000","locked":"0.00000000"},{"asset":"MATIC","free":"0.00000000","locked":"0.00000000"},{"asset":"ATOM","free":"0.00000000","locked":"0.00000000"},{"asset":"PHB","free":"0.75700000","locked":"0.00000000"},{"asset":"ONE","free":"0.00000000","locked":"0.00000000"},{"asset":"FTM","free":"0.00000000","locked":"0.00000000"},{"asset":"BTCB","free":"0.00000000","locked":"0.00000000"},{"asset":"USDSB","free":"0.00000000","locked":"0.00000000"},{"asset":"CHZ","free":"0.00000000","locked":"0.00000000"},{"asset":"COS","free":"0.00000000","locked":"0.00000000"},{"asset":"ALGO","free":"0.00000000","locked":"0.00000000"},{"asset":"ERD","free":"0.00000000","locked":"0.00000000"},{"asset":"DOGE","free":"0.00000000","locked":"0.00000000"},{"asset":"BGBP","free":"0.00000000","locked":"0.00000000"},{"asset":"DUSK","free":"0.00000000","locked":"0.00000000"},{"asset":"ANKR","free":"0.00000000","locked":"0.00000000"},{"asset":"WIN","free":"0.00000000","locked":"0.00000000"},{"asset":"TUSDB","free":"0.00000000","locked":"0.00000000"},{"asset":"COCOS","free":"0.00000000","locked":"0.00000000"},{"asset":"PERL","free":"0.00000000","locked":"0.00000000"},{"asset":"TOMO","free":"0.00000000","locked":"0.00000000"},{"asset":"BUSD","free":"0.00000000","locked":"0.00000000"},{"asset":"BAND","free":"0.00000000","locked":"0.00000000"},{"asset":"BEAM","free":"0.00000000","locked":"0.00000000"},{"asset":"HBAR","free":"0.00000000","locked":"0.00000000"},{"asset":"XTZ","free":"0.03229919","locked":"9.99000000"},{"asset":"NGN","free":"0.00000000","locked":"0.00000000"},{"asset":"NKN","free":"0.00000000","locked":"0.00000000"},{"asset":"EUR","free":"0.00000000","locked":"0.00000000"},{"asset":"KAVA","free":"0.00000000","locked":"0.00000000"},{"asset":"RUB","free":"0.00000000","locked":"0.00000000"},{"asset":"ARPA","free":"0.00000000","locked":"0.00000000"},{"asset":"TRY","free":"0.00000000","locked":"0.00000000"},{"asset":"CTXC","free":"0.00000000","locked":"0.00000000"},{"asset":"BCH","free":"0.00060400","locked":"0.00000000"},{"asset":"TROY","free":"0.00000000","locked":"0.00000000"},{"asset":"VITE","free":"0.00000000","locked":"0.00000000"},{"asset":"FTT","free":"0.00000000","locked":"0.00000000"},{"asset":"OGN","free":"0.00000000","locked":"0.00000000"},{"asset":"DREP","free":"0.00000000","locked":"0.00000000"},{"asset":"BULL","free":"0.00000000","locked":"0.00000000"},{"asset":"BEAR","free":"0.00000000","locked":"0.00000000"},{"asset":"ETHBULL","free":"0.00000000","locked":"0.00000000"},{"asset":"ETHBEAR","free":"0.00000000","locked":"0.00000000"},{"asset":"XRPBULL","free":"0.00000000","locked":"0.00000000"},{"asset":"XRPBEAR","free":"0.00000000","locked":"0.00000000"},{"asset":"EOSBULL","free":"0.00000000","locked":"0.00000000"},{"asset":"EOSBEAR","free":"0.00000000","locked":"0.00000000"},{"asset":"TCT","free":"0.00000000","locked":"0.00000000"},{"asset":"WRX","free":"0.00000000","locked":"0.00000000"},{"asset":"LTO","free":"0.00000000","locked":"0.00000000"},{"asset":"ZAR","free":"0.00000000","locked":"0.00000000"},{"asset":"MBL","free":"0.00000000","locked":"0.00000000"},{"asset":"COTI","free":"0.00000000","locked":"0.00000000"},{"asset":"BKRW","free":"0.00000000","locked":"0.00000000"},{"asset":"BNBBULL","free":"0.00000000","locked":"0.00000000"},{"asset":"BNBBEAR","free":"0.00000000","locked":"0.00000000"},{"asset":"STPT","free":"0.00000000","locked":"0.00000000"}]}
     */
    public static BigDecimal parseAssetBalanceFree(final String jsonString, final String asset) throws IOException {
        GateUtils.checkParamNotEmpty(asset, "asset");

        for (JsonNode balanceNode : mapper.readTree(jsonString).get("balances")) {
            if (asset.equals(balanceNode.get("asset").asText())) {
                return new BigDecimal(balanceNode.get("free").asText());
            }
        }
        return null;
    }

}
